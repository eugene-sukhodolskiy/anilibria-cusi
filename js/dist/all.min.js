class Alert{constructor(e,A,t,r){this.id="alert-id-"+(new Date).getTime()+Math.random(),(alertsList[this.id]=this).type=e,this.content=A||"",this.isSingleton=t||!1,this.isClosable=r||!1;e=document.querySelector('.component.alert[data-id="alert-id-reference"]');if(!e)return console.error("Reference of alert component not found");this.template=e.cloneNode(!0),this.template.getInstance=()=>this,this.initComponent()}initComponent(){this.template.classList.add("alert-"+this.type),this.template.setAttribute("data-id",this.id),this.template.querySelector(".content").innerHTML=this.content,this.template.querySelector(".close-alert").addEventListener("click",e=>{e.preventDefault(),this.close()})}showIn(e){return!!this.template&&(this.isSingleton&&(e.innerHTML=""),e.append(this.template),setTimeout(()=>{this.template.classList.add("show")},10),this)}close(){this.template.classList.remove("show"),setTimeout(()=>{this.template.remove(),delete alertsList[this.id]},150)}changeContent(e){this.template.querySelector(".content").innerHTML=e}}const closeAlertComponent=e=>alertsList[e]?.close(),createAlertComponent=(e,A,t,r)=>new Alert(e,A,t,r),createGlobalAlertComponent=(e,A,t,r)=>{e=createAlertComponent(e,A,t,r);return e.showIn(document.querySelector(".global-alerts-container")),e},alertsList=(document.addEventListener("DOMContentLoaded",e=>{document.querySelectorAll(".component.alert .close-alert").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();e=e.currentTarget.getAttribute("data-close-alert-id");closeAlertComponent(e)})})}),{});class App{constructor(){this.router=new Router(".page-container","home","not-found"),this.auth=new Auth("#login .login-form form"),this.renderer=new Renderer,this.postRender=new PostRender,this.loader=new Loader,this.cacheProvider=new CacheProvider,setTimeout(()=>{this.init()},10)}init(){initRoutesEvents(this),this.router.urlMonitor(),this.initDisplayingAuthBtns(),this.initPreloadSpinner(),this.initBaseEvents(),this.initGenres()}initPreloadSpinner(){document.querySelectorAll(".preload-spinner").forEach(e=>{e.innerHTML=this.renderer.renderPreloadSpinner()})}initBaseEvents(){document.querySelector(".logout-btn").addEventListener("click",e=>{this.auth.logout()}),document.querySelector(".btn-nav-on-mob-show").addEventListener("click",e=>{(e.currentTarget.classList.contains("active")?hideMobNav:showMobNav)()}),document.querySelector('[name="search"]').addEventListener("keyup",e=>{var A;e.preventDefault(),13==e.keyCode&&(A=e.currentTarget.value.trim(),document.location.hash="page:search;sq:"+A,e.currentTarget.blur())});const s={home:this.loader.homePageUpToLoad,search:this.loader.searchPageUpToLoad,genres:this.loader.genresPageUpToLoad};for(let r in s){const n=document.querySelector("#"+r);n.querySelector(".more-btn").addEventListener("click",e=>{const A=n.querySelector(".render-container");var t=A.childNodes.length;n.querySelector(".more-btn-wrap .preload-spinner").classList.remove("dnone"),n.querySelector(".more-btn").classList.add("dnone"),s[r](t,e=>{n.querySelector(".more-btn-wrap .preload-spinner").classList.add("dnone"),e.list.length&&n.querySelector(".more-btn").classList.remove("dnone"),insertListToRenderContainer(A,e.list)})})}}initGenres(){this.loader.genresList(e=>{document.querySelector("#genres .render-genres").appendChild(this.renderer.renderGenresList(e).node)})}initDisplayingAuthBtns(){getSessionId()?(document.querySelector(".logout-btn").classList.remove("dnone"),document.querySelector(".go-login-page-btn").classList.add("dnone")):(document.querySelector(".logout-btn").classList.add("dnone"),document.querySelector(".go-login-page-btn").classList.remove("dnone"))}}document.addEventListener("DOMContentLoaded",e=>{const A=new App;window.app=()=>A});class Auth{constructor(e){this.formSelector=e,this.form=document.querySelector(this.formSelector),this.submitBtn=this.form.querySelector(".submit-btn"),this.initForm()}initForm(){this.form.addEventListener("submit",e=>{if(e.preventDefault(),!this.submitBtn.classList.contains("disable")){this.submitBtn.classList.add("disable");var e=this.form.querySelector("#email").value,A=this.form.querySelector("#passwd").value;const s=new XMLHttpRequest;s.open("POST","https://www.anilibria.tv/public/login.php"),s.onload=()=>{if(this.submitBtn.classList.remove("disable"),200==s.status){var e=JSON.parse(s.response);if("ok"==e.err){localStorage.setItem("sessionId",e.sessionId);const A=createGlobalAlertComponent("success","Успешно!");setTimeout(()=>{A.close()},2e3),document.location.hash="#",document.querySelector(".logout-btn").classList.remove("dnone"),document.querySelector(".go-login-page-btn").classList.add("dnone")}else{const t=createGlobalAlertComponent("danger",e.mes);setTimeout(()=>{t.close()},4500)}}else{const r=createGlobalAlertComponent("danger","Сервер не доступен");setTimeout(()=>{r.close()},4500)}};var t=new FormData;t.append("mail",e),t.append("passwd",A),t.append("fa2code",""),t.append("csrf","1"),s.send(t)}})}logout(){localStorage.removeItem("sessionId"),document.location.hash="#page:login",document.querySelector(".logout-btn").classList.add("dnone"),document.querySelector(".go-login-page-btn").classList.remove("dnone"),app().cacheProvider.unsetCache("favouritesList")}}class CacheProvider{constructor(){this.cache={},this.lifetime={},this.createAt={},this.init(),setInterval(()=>{this.manager()},1e3)}init(){var e=localStorage.getItem("cache");e&&(e=JSON.parse(e),this.cache=e.cache,this.lifetime=e.lifetime,this.createAt=e.createAt)}setCache(e,A,t){this.cache[e]=A,this.lifetime[e]=t,this.createAt[e]=Math.round((new Date).getTime()/1e3),this.saveCache()}saveCache(){localStorage.setItem("cache",JSON.stringify({cache:this.cache,lifetime:this.lifetime,createAt:this.createAt}))}cacheable(A,e,t,r){if(this.cache[A])return t(this.cache[A]);e(e=>{this.setCache(A,e,r),t(e)})}unsetCache(e){this.cache[e]&&(delete this.cache[e],delete this.lifetime[e],delete this.createAt[e],this.saveCache())}manager(){var e,A=Math.round((new Date).getTime()/1e3);for(e in this.cache)this.lifetime[e]&&A-this.createAt[e]>this.lifetime[e]&&this.unsetCache(e)}}class Loader{constructor(){}homePageUpToLoad(e,A){anilibriaRequest("title/updates",{after:e,limit:_CONF.perPage.home,filter:getItemCardFields()},e=>A(e))}searchPageUpToLoad(e,A){var t=decodeURI(document.location.hash.split("sq:")[1]);anilibriaRequest("title/search",{after:e,limit:_CONF.perPage.search,filter:getItemCardFields(),search:t},e=>A(e))}genresPageUpToLoad(e,A){var t=getSelectedGenres();anilibriaRequest("title/search",{search:"",filter:getItemCardFields(),genres:t.join(","),after:e,limit:_CONF.perPage.search},e=>A(e))}favouritesList(e){const t=getSessionId();if(!t)return setTimeout(()=>document.location.hash="#page:login",20);app().cacheProvider.cacheable("favouritesList",A=>{anilibriaRequest("v2.13:getFavorites",{session:t,limit:100,filter:getItemCardFields()},e=>A(e))},e,300)}genresList(e){app().cacheProvider.cacheable("genresList",A=>{anilibriaRequest("genres",{sorting_type:1},e=>A(e))},e,10800)}}class PostRender{constructor(){}itemCard(e){e=nodeFromHTML(e);return e.querySelector(".thumbnail-img").addEventListener("load",e=>{e.currentTarget.parentNode.parentNode.classList.add("load-ready")}),e}single(e,A){var t,e=nodeFromHTML(e);const r={id:"main-player-"+A.id,default_quality:"720p",preroll_deny:"",file:[]};for(t in A.player.list){let e="[480p]https://"+A.player.host+A.player.list[t].hls.sd;A.player.list[t].hls.hd&&(e+=",[720p]https://"+A.player.host+A.player.list[t].hls.hd),A.player.list[t].hls.fhd&&(e+=",[1080p]https://"+A.player.host+A.player.list[t].hls.fhd),r.file.push({id:"s"+t,skip:A.player.list[t].skips.opening.length?A.player.list[t].skips.opening.join("-"):null,title:"Серия "+t,poster:null,download:null,file:e})}return setTimeout(()=>{new Playerjs(r)},30),e.querySelector(".fav-btn-wrap").appendChild(app().renderer.renderFavoriteBtn(A).node),e.querySelector(".thumbnail-img").addEventListener("load",e=>{e.currentTarget.parentNode.classList.add("load-ready")}),e}favoriteBtn(e,t){const r=nodeFromHTML(e);return getSessionId()&&(r.querySelector(".state.unset-from").classList.add("dnone"),r.querySelector(".state.set-to").classList.remove("dnone"),app().loader.favouritesList(A=>{for(let e=0;e<A.length;e++)if(t==A[e].id){r.querySelector(".state.unset-from").classList.remove("dnone"),r.querySelector(".state.set-to").classList.add("dnone");break}r.classList.remove("dnone")}),r.addEventListener("click",e=>{e.currentTarget.querySelector(".unset-from").classList.contains("dnone")?addToFavourites(t,e=>{r.querySelector(".state.unset-from").classList.remove("dnone"),r.querySelector(".state.set-to").classList.add("dnone")}):removeFromFavourites(t,e=>{r.querySelector(".state.unset-from").classList.add("dnone"),r.querySelector(".state.set-to").classList.remove("dnone")})})),r}genreBtn(e){e=nodeFromHTML(e);return e.addEventListener("click",e=>{e.preventDefault();var A=e.currentTarget.getAttribute("data-genre-name");let t=document.location.hash.split("sg:")[1];var r=(t=t?t.split(",").map(e=>decodeURI(e)):[]).indexOf(A);-1===r?(t.push(A),e.currentTarget.classList.add("active")):(t.splice(r,1),e.currentTarget.classList.remove("active")),document.location.hash="page:genres;sg:"+t.join(",")}),e}}class Renderer{constructor(){}renderThumbnail(e){var A=e.status.string||"Завершен";return`
			<div class="component thumbnail">
				<img src="//anilibria.tv${e.posters.medium.url}" class="thumbnail-img">
				<img 
					src="data:image/jpeg;base64,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" 
					class="poster-placeholder"
				>
				<div class="hover-effect">
					<span class="mdi mdi-arrow-right"></span>
				</div>
				<div class="status">${A}</div>
				<div class="series">Серий ${e.player.episodes.last}</div>
			</div>
		`}renderItemCard(e){var A=e.genres.join(", "),t=this.renderThumbnail(e),t=`<a href="#page:single;id${e.id}" class="no-decoration item-link">
			<div class="component card item-card" data-id="${e.id}">
				${t}
				<div class="info">
					<div class="title">${e.names.ru} (<span class="year">${e.season.year}</span>)</div>
					<div class="meta">
						<div class="genres">${A}</div>
						<div class="type">${e.type.full_string}</div>
					</div>
				</div>
			</div>
		</a>`;return{string:t,node:app().postRender.itemCard(t)}}renderTorrents(t){let r='<div class="component torrents">';for(let A=0;A<t.torrents.list.length;A++){var s=t.torrents.list[A];let e=s.total_size/1024/1024;e=1024<e?(e/1024).toString().split(".")[0]+"."+(e/1024).toString().split(".")[1].substr(0,2)+" ГБ":e.toString().split(".")[0]+"."+e.toString().split(".")[1].substr(0,2)+" МБ",r+=`
				<div class="torrent" data-torrent-id="${s.torrent_id}">
					<div class="series">Серии ${s.episodes.string}</div>
					<div class="quality">${s.quality.string}</div>
					
					<div class="seed-leech">
						<span class="seed">
							<span class="mdi mdi-arrow-up"></span>
							${s.seeders}
						</span>
						<span class="leech">
							<span class="mdi mdi-arrow-down"></span>
							${s.leechers}
						</span>
					</div>
					<div class="download">
						<a href="//anilibria.tv${s.url}" class="std-btn btn-success" target="_blank">
							<span class="mdi mdi-download"></span>
							<span class="btn-label">Скачать</span>
							<span class="btn-tsize">${e}</span>
						</a>
					</div>
				</div>
			`}return r+="</div>"}renderFavoriteBtn(e){var A=`<button class="std-btn btn-warning fav-btn dnone" data-id="${e.id}">
			<span class="state unset-from">
				<span class="mdi mdi-star"></span>
				В избранном
			</span>
			<span class="state set-to">
				<span class="mdi mdi-star-outline"></span>
				Добавить в избранное
			</span>
		</button>`;return{html:A,node:app().postRender.favoriteBtn(A,e.id)}}renderSingle(e){var A=this.renderGenresList(e.genres).html,t=this.renderThumbnail(e),r=this.renderTorrents(e),t=`<div class="component single-item">
			<div class="std-row">
				${t}
				<div class="item-info">
					<h2 class="title"><strong>${e.names.ru}</strong> / ${e.names.en}</h2>
					<div class="time-period">${e.season.string||""} ${e.season.year}</div>
					<div class="genres">${A}</div>
					<div class="type">${e.type.full_string}</div>
					<div class="description">${e.description}</div>
					<div class="control-panel">
						<div class="fav-btn-wrap"></div>
					</div>
					${r}
				</div>
			</div>

			<div class="player" id="main-player-${e.id}"></div>
		</div>`;return{string:t,node:app().postRender.single(t,e)}}renderPreloadSpinner(){return`<div class="loadingio-spinner-dual-ball-9pyhqeozhs"><div class="ldio-jyt13pqa73">
			<div></div><div></div><div></div>
			</div></div>`}renderGenreBtn(e){e=`<a 
			href="#page:genres;sg:${e}" 
			class="std-btn genre-btn" 
			data-genre-name="${e}"
		>
			${e}
		</a>`;return{html:e,node:app().postRender.genreBtn(e)}}renderGenresList(A){var t=document.createElement("DIV");t.classList.add("genres-wrap");let r='<div class="genres-wrap">';for(let e=0;e<A.length;e++){var s=this.renderGenreBtn(A[e]);t.appendChild(s.node),r+=s.html}return{html:r+="</div>",node:t}}}class Router{constructor(e,A,t){this.containerSelector=e,this.container=document.querySelector(this.containerSelector),this.defaultPageId=A,this.notFoundPageId=t,this.events={};var r=this.container.querySelectorAll(".page[id]");this.pages={};for(let e=0;e<r.length;e++)this.pages[r[e].getAttribute("id")]=r[e];this.currentPage="default-val",this.currentPath="default-val",this.zindex=1}goToPage(e){return void 0===e?document.location.hash="page:"+this.defaultPageId:void 0===this.pages[e]?this.goToPage(this.notFoundPageId):(this.container.querySelectorAll(".page.show").forEach(e=>e.classList.remove("show")),void 0!==this.pages[e]&&(this.events.jumpTo&&this.events.jumpTo(this,e),this.events[e]&&this.events[e](this),this.pages[e].style.zIndex=this.zindex,this.zindex++),this.pages[e]?.classList.add("show"),window.scrollTo({top:0}),this.currentPage=e,void(this.currentPath=document.location.hash))}urlMonitor(){setInterval(()=>{var e=document.location.hash.split("page:")[1];document.location.hash!=this.currentPath&&this.goToPage(e?.split(";")[0])},10)}addEvent(e,A){this.events[e]=A}}const _CONF={api:{domen:"api.anilibria.tv",ver:"v3"},perPage:{home:20,search:20,genres:20},numbOfRelevant:12},getSessionId=()=>{var e=localStorage.getItem("sessionId");return e||!1},stdXHR=(e,A,t)=>{const r=new XMLHttpRequest;return r.open(e,A),r.setRequestHeader("Cache-Control","no-cache, no-store, max-age=0"),r.onload=()=>{if(200==r.status)t(r);else{404==r.status&&app().router.goToPage("not-found");const e=createGlobalAlertComponent("danger","Ошибка загрузки данных");setTimeout(()=>e.close(),3e3)}},r.onerror=()=>{const e=createGlobalAlertComponent("danger","Сервер не доступен");setTimeout(()=>e.close(),3e3)},r},showMobNav=()=>{document.querySelector(".btn-nav-on-mob-show").classList.add("active"),document.querySelectorAll(".navigation-main-wrapper, .userbar-wrapper").forEach(e=>{e.classList.add("show")})},hideMobNav=()=>{document.querySelector(".btn-nav-on-mob-show").classList.remove("active"),document.querySelectorAll(".navigation-main-wrapper, .userbar-wrapper").forEach(e=>{e.classList.remove("show")})},makeSelectedGenresActivated=()=>{let A=document.location.hash.split("sg:")[1];A=A?A.split(",").map(e=>decodeURI(e)):[],document.querySelectorAll("#genres .render-genres .genre-btn.active").forEach(e=>e.classList.remove("active"));for(let e=0;e<A.length;e++)document.querySelector(`#genres .render-genres .genre-btn[data-genre-name="${A[e]}"]`)?.classList.add("active")},getItemCardFields=()=>["id","code","names","genres","posters","status","player","season","type"],setPageTitle=e=>{document.querySelector("head title").innerHTML=e},nodeFromHTML=e=>{var A=document.createElement("DIV");return A.innerHTML=e,item=A.childNodes[0]},addToFavourites=(e,A)=>{var t=getSessionId();t&&anilibriaRequest("user/favorites",{session:t,title_id:e},e=>{app().cacheProvider.unsetCache("favouritesList"),A(e)},"PUT")},removeFromFavourites=(e,A)=>{var t=getSessionId();t&&anilibriaRequest("user/favorites",{session:t,title_id:e},e=>{app().cacheProvider.unsetCache("favouritesList"),A(e)},"DELETE")},insertListToRenderContainer=(A,t)=>{for(let e=0;e<t.length;e++)A.appendChild(app().renderer.renderItemCard(t[e]).node)},anilibriaRequest=(e,A,t,r)=>{A=A||{},r=r||"GET";let s=_CONF.api.ver,n=(-1!=e.indexOf(":")&&([s,e]=e.split(":")),`//${_CONF.api.domen}/api/${s}/`+e);A.filter&&(A.filter=A.filter.join(",")),0===A.after&&delete A.after;e=new URLSearchParams(A).toString();e&&(n+="?"+e),stdXHR(r,n,e=>{e=JSON.parse(e.response);t(e)}).send()},getSelectedGenres=()=>{var e=document.location.hash.split("sg:")[1];return(e=decodeURI(e)).length?e.split(","):[]},initRoutesEvents=n=>{n.router.addEvent("jumpTo",(e,A)=>{document.querySelectorAll("#single .render-container").forEach(e=>{e.innerHTML=""}),document.querySelector(`#${A} .preload-spinner`)?.classList.remove("dnone"),document.querySelector('[name="search"]').value="",document.querySelectorAll(".page .more-btn").forEach(e=>e.classList.add("dnone")),hideMobNav();A=document.querySelector("#"+A)?.getAttribute("data-title");setPageTitle(A)}),n.router.addEvent("login",e=>{getSessionId()&&(document.location.hash="page:"+e.notFoundPageId)}),n.router.addEvent("home",e=>{n.loader.homePageUpToLoad(0,e=>{var A=document.querySelector("#home .render-container");A.innerHTML="",document.querySelector("#home .preload-spinner").classList.add("dnone"),e.list.length&&document.querySelector("#home .more-btn").classList.remove("dnone"),insertListToRenderContainer(A,e.list)})}),n.router.addEvent("single",e=>{const s=document.location.hash.split("id")[1];anilibriaRequest("title",{id:s},e=>{setPageTitle(e.names.ru);const A=e.genres.join(",");var t=document.querySelector("#single .render-container.main-render");t.innerHTML="",document.querySelector("#single .preload-spinner").classList.add("dnone"),t.appendChild(n.renderer.renderSingle(e).node),e.names.ru,getItemCardFields().join(",");anilibriaRequest("title/search",{search:e.names.ru,after:0,limit:_CONF.numbOfRelevant,filter:getItemCardFields()},e=>{e.list.splice(_CONF.numbOfRelevant,e.list.length);const t=e.list.map(e=>e.id),r=document.querySelector("#single .render-container.relevant-items-render");r.innerHTML="",insertListToRenderContainer(r,e.list.filter(e=>e.id!=s)),0<_CONF.numbOfRelevant-r.childNodes.length&&anilibriaRequest("title/search",{search:"",genres:A,after:0,limit:_CONF.numbOfRelevant+1,filter:getItemCardFields()},A=>{A.list=A.list.filter(e=>e.id!=s);for(let e=0;e<A.list.length;e++){if(r.childNodes.length>=_CONF.numbOfRelevant)return!1;-1<t.indexOf(A.list[e].id)||r.appendChild(n.renderer.renderItemCard(A.list[e]).node)}})})})}),n.router.addEvent("favourites",e=>{n.loader.favouritesList(A=>{var t=document.querySelector("#favourites .render-container");document.querySelector("#favourites .preload-spinner").classList.add("dnone"),t.innerHTML="";for(let e=A.length-1;0<=e;e--)A[e].player.episodes=A[e].player.series,t.appendChild(n.renderer.renderItemCard(A[e]).node)})}),n.router.addEvent("search",e=>{var A=decodeURI(document.location.hash.split("sq:")[1]);document.querySelector('[name="search"]').value=A,n.loader.searchPageUpToLoad(0,e=>{var A=document.querySelector("#search .render-container");A.innerHTML="",document.querySelector("#search .preload-spinner").classList.add("dnone"),e.list.length&&document.querySelector("#search .more-btn").classList.remove("dnone"),insertListToRenderContainer(A,e.list)})}),n.router.addEvent("new-series",e=>{anilibriaRequest("title/updates",{after:0,limit:60,filter:getItemCardFields()},r=>{const s=document.querySelector("#new-series .render-container");s.innerHTML="",document.querySelector("#new-series .preload-spinner").classList.add("dnone"),n.loader.favouritesList(t=>{for(let A=0;A<r.list.length;A++)for(let e=0;e<t.length;e++)if(t[e].id==r.list[A].id){s.appendChild(n.renderer.renderItemCard(r.list[A]).node);break}})})}),n.router.addEvent("genres",e=>{var A=document.location.hash.split("sg:")[1],t=(setTimeout(()=>{makeSelectedGenresActivated()},30),document.querySelector("#genres .render-container"));A?n.loader.genresPageUpToLoad(0,e=>{var A=document.querySelector("#genres .render-container");A.innerHTML="",document.querySelector("#genres .preload-spinner").classList.add("dnone"),e.list.length&&document.querySelector("#genres .more-btn").classList.remove("dnone"),insertListToRenderContainer(A,e.list)}):(t.innerHTML="",document.querySelector("#genres .preload-spinner").classList.add("dnone"))})};
//# sourceMappingURL=all.min.js.map
